{"path":"Git Ignore/Heavy Stuff/Matthew Barnes Notes/3210 - Adv Computer Networks.pdf","text":"Advanced Computer Networks Felix Whitefield Exam 2022/23 5 Coursework 5 Introduction 5 RadioFundamentals 7 Electro-Magenetic Spectrum 7 Radio Spectrum 8 Modulation 9 Amplitude Shift Keying (ASK) 10 Frequency Shift Keying (FSK) 11 Phase Shift Keying (Binary) 12 Quadrature Phase Shift Keying 12 Quadrature Amplitude Modulation 13 Lora Modulation 13 Applications of modulation schemes 13 Multiple Access 14 Frequency Division (FDMA) 14 Time Division (TDMA) 14 Code Division (CDMA) 14 Internet of Things 15 Challenges of IoT 16 Communication Choices 16 Architecture of embedded IoT 19 Handling Data 19 IoT Architectures 21 Basic software elements 21 Networks 22 Low Power WANs (LPWAN) 27 LoRa modulation (LoRa → Long Range) 27 Characteristics of LoRA 27 Semtech Devices 28 LoRaWAN Architecture 28 LoRaWAN Gateways 29 Channels and Restrictions 30 Modulation and Data Rates 30 Devices IDs 33 Frame Counter 33 The Things Network 33 Sigfox (Competitor to LoRaWAN) 33 Weightless (LPWAN) 34 NB-IoT (Narrowband-IoT) 34 Nano-satcoms 34 MQTT and CoAP 35 MQTT 35 CoAP 37 CoAP header 38 WiFi & WWAN 44 Wi-Fi 44 Standards 45 How has WiFi gotten faster? 45 DSSS 45 FDM 46 OFDM 46 OFDMA 48 Beamforming 49 MIMO 50 Mu-MIMO 50 Digital Modulation 51 Multiple Access 51 Propagation Effects 52 WiFi Bands & Interference 52 2.4GHz 52 5GHz 53 WiFi 6 54 DFS 54 Less Common Wi-Fi bands 54 Target Wake Time 55 Spatial Reuse with BSS Colouring 55 WiFi 7 - 802.11be 55 Security 56 Low Power WiFi 57 WWAN (UMTS) 57 Summary 58 Bluetooth 58 Bluetooth Information 59 2.4GHz Spectrum Band 60 Multiple Users 61 Packets 63 Frame Types 64 Extended Protocols 65 6LoWPAN & 802.15.4 67 IEEE 802.15.4 67 Applications 67 Other Options 68 History 69 Supported Freq & Data Rates 69 Device Types 70 Network Topologies 70 Frame structure 71 ZigBee Standard 72 6LoWPAN 73 Decoding 75 IoT 78 Advantages of using 6LoWPAN 78 Summary 78 Sensor Networks 79 Wireless Sensor Networks 79 Power-Aware Routing 79 List-Sleep media access protocols 80 Multi-hop Routing 80 Low-Energy Adaptive Clustering Hierarchy (LEACH) 81 Environmental Sensor Networks 81 IoT and standards 82 Communication 83 CoAP 83 Gateway/Border Router 83 IPv6 84 IPv4 - The problem 84 Solutions? 85 IPv6 86 Crunch Time 86 Why don’t we use it? 87 Motivation 87 Misconceptions 87 Challenges 87 Deployment 88 DUIDs 89 Dual-Stack Deployment 89 Smart-Home 90 Home automation 90 Thread & Matter 91 Home Assistant 92 IPv6- 2 96 Tunnelling 96 NAT64 (RFC 6146) 99 DNS64 99 464XLAT (RFC 6877) 100 Dual-Stack Lite (DS-Lite) 101 Network Security 101 Network Attacks 101 Mandiant Cyber Attack Life Cycle 102 Defending Against Attack 104 Security Policies 104 Users Problem? 105 Ongoing Maintenance 105 Regular Auditing 105 Incident Response 106 First Hop Security 106 IPv6! 107 Make use of Reputation 107 Detect Breach 107 Tim Chown 107 802.1X 107 Networking Monitoring 108 Network Flow Monitoring 108 Packet Capture 109 Intrusion Detection (IDS) 110 Intrusion Prevention 110 TL;DR 111 LPWAN’s 112 WiFi + Bluetooth 112 LR-WPAN’s 115 Comparison 116 IPv6 117 Network Security 120 Projects 122 Notes page Exam 2022/23 - Some choice between the questions - 2 from A, 2 from B (6 Qs total) 1. (potentially 2qs on) Design a network system → IoT Sensor network level - Sensor nodes → Making your own network a. Document all LPWANs and other network technologies b. 802.15.4 with 868Mhz gives longer range (lower frequencies) - High frequencies make it lower range (2.4Ghz lower range) 2. Network security → Such as IDS, etc… Defence 3. Question on cyber Coursework Ideas - Using MQTT with IoT devices linked to an application, such as HomeAssistant - IoT devices to server that can be viewed from website (maybe over MQTT), monitoring - PIR sensor + bluetooth phone detector, turn on light if both correctly detected otherwise send message to phone? - Could add photoelectric sensor to only turn on light at night - Pi or small board to act as server and record history? - Use HomeAssistant plugin? - (Open)Thread + Matter? Introduction Wireless Networking standards - Bluetooth - WLAN (IEEE 802.11) - WWAN (GSM/UMTS/EDGE/HSDPA) - LPWAN (LoraWAN, SigFox, NB-IoT) Applications - Sensor networks - Internet of Things Practical Networking - 802.15.4 The layers / levels of the IoT World Forum reference model 1. Physical Devices and Controllers (The “Things” in IoT) 2. Connectivity (Communication & Processing units) 3. Edge Computer (Data Element Analysis & Transformation) 4. DataAccumulation(Storage) 5. DataAbstraction(Aggregation and access) 6. Application(Reporting, analytics, control) 7. Collaborationand Processes (Involving people) Wireless networks - Bandwidth and information theory - Estimating bandwidth requirements - How do we quantify information? - Modulation and multiple access - How do we send information using radio waves? Information Theory - We measure information in ‘bits’ - We often confuse data and information - Information has a specific meaning in communication theory - Shannon → Started information theory - Proposed a measure of information that considers a discrete random variable and asks how much information is received when we observe a specific value for this variable - Shannon Entropy:h(x) = -log2p(x) - - Shannon Information - The less likely a value, the more information is imparted by revealing its value - If we learn two independent facts, information is additive - so SUM all h values - p(x,y) = p(x)p(y) - h(x,y) = h(x) + h(y) - For a series of values. The average amount of information transmitted is given by:- H(x) = -∑p(x)log2(p(x)) - This is called the informationentropy - Example with binary digits - Consider random variable x which as 8 possible values, each of which is likely - H(x) = -8 x ⅛ log2 (⅛) = 3 bits - This makes sense as we need 3 bits to represent all 8 states. - We can say this data stream only needs 3 bits per sample to represent all the information - Non-Uniform Distributions - What if the 8 possibilities have different probabilities? - Then it is: - - Less information entropy that the uniform case - Compact Representations - Shannon’s figure is the lower bound we can aim for… - Use more bits for higher information states - Average length of transmitted code is then 2 bits… - So, the average will be the given bit number. But it can be higher - Use good coding to achieve this (Huffman coding) Radio Fundamentals And Error Correction Electro-Magenetic Spectrum - The EM spectrum is used in a lot of applications - The Radio spectrum is useful to us for transmitting data → 1Hz → 3000GHz (3 THz) - E.g. WiFi 2.4GHz Radio Spectrum - Centre frequency and bandwidth - The bandwidth is the difference between the upper and lower frequencies in a continuous band of frequencies - The centre frequency is the central frequency within a bandwidth. - - The more bandwidth (wider frequency) the higher the data rate achievable - The higher the frequency, the easier it is to use more bandwidth (more room to use) - The radio spectrum is taken up by many different applications, e.g. radio, television etc… What frequencies are used for what? - IEEE 802.15.4, Bluetooth etc - 2.4GHz - WiFi - 2.4GHz, 5GHz and now 60GHz (802.11ad/WiGig) - ISM licence free bands, sub-GHz - 433, 868MHz - GSM-900 - Mobile:890 - 915 MHz - Base 925 - 960 MHz - GSM-1800 - Mobile:1710 - 1785 MHz - Base:1805 - 1880 MHz - 3G - Mobile:1920 - 1980 MHz - Base:2210 - 2170MHz - 4G - 800Mhz, 1800Mhz, 2.6 GHz - 5G - ~28GHz 2.4GHz can be absorbed by humans (the water inside), so WiFi can get worse in a room full of humans - Lots of different standards, lots of different frequencies RadioPropagation - Radio waves reflect, refract, diffract… Depending on frequency and environment conditions - Waves are modulated when received - The refracted waves are picked up too and can cause interference - Antenna is big part, needs to be able to receive / send the correct frequency of radio waves Link Budget - Summary of the gains/losses in a radio system - Simplified Received Power:(RxP - Received power, Tx-P - Transmission power) - RxP = Tx-P(dBm) + Gains(dB) - Losses(dB) - Reality is more like: - PRX = PTX + GTX + GRX − LTX − LFS − LP − LRX - PRX = received power - PTX = transmitter output power - GTX = transmitter antenna gain - GRX = receiver antenna gain - LTX = transmit feeder and associated losses (feeder, connectors, etc.) - LFS = free space loss or path loss - LP = miscellaneous losses There’s so much… Sensitivity of the receivers is so good. Basically, there is no simple way to know if a radio link will work in the real-world. There is lots of interference and loss of signal. Gain makes signal stronger Modulation - To transmit digital information, we need to send a sequence of bits. - This isn’t trivial over radio - Often not possible over a long wired link either (hence use of modem) - We modulate our signal onto a carrier frequency - Modulation is the process of converting data into radio waves. - Generally have one carrier frequency then - We can change a number of things (to represent bits) - Amplitude - Frequency - Phase Amplitude Shift Keying (ASK) - Idealised it would look like this: - - AM Radio - Simple but prone to interference - Looks like this in real life: - Frequency Shift Keying (FSK) - Older - - Was used for Weather Fax - Regular daily transmission on SW radio - Uses FSK modulation - 2000 Hz carrier (Long distance) - 800 Hz frequency shift Phase Shift Keying (Binary) - More modern - - Requires a synchronised waveform at the receiver Quadrature Phase Shift Keying - Can send multiple bits simultaneously by extending using multiple phase shifts - - GPS uses binary phase shift keying - 180 degree shift - The more symbols (or phase shifts) the more noise will affect the signal. Quadrature Amplitude Modulation - Combines Phase Shift and Amplitude keying. - - We gain bandwidth:There’s more bits, but it is more sensitive to noise as you increase the complexity. (QAM64 is used in US cable TV) Lora Modulation - Spread spectrum chirp - Slow but robust - Good for long range - Max bitrate in Semtech’s lora depends on the “spreading factor” - Lower SF for higher data rate - It also affects sensitivity and therefore range Applications of modulation schemes - Bluetooth - GMSK (In GSM as well) - Minimum possible frequency shift + Gaussian filter - DQPSK - Differential encoding uses data to change rather than set the phase - WiFi - BPSK & QPSK - 16 QAM & 64 QAM - UMTS - Universal Mobile Telecommunications System - QPSK - LORA - Low power LoRaWAN Multiple Access - How can multiple devices use the same bands? Frequency Division (FDMA) - Divide frequency band into channels (Each user gets their own frequency) - Assign each user a different channel - Uplink and downlink may be on different channels - Used in analogue radio systems - Bandwidth is wasted whenever a user is offline Time Division (TDMA) - Divide access to frequency bands into a number of distinct time slots. - Used by GSM - Requires time synchronisation - Difficult with mobile transceivers - Base station informs mobiles of delay required depending on distance - Single slow available for registering with the base station - Slot width corresponds to 35 km transmission delay - Sets the max range of the mobile - Dynamic TDMA - Users with different requirements may be allocated multiple time slots - Used in bluetooth Code Division (CDMA) - Same carrier frequency but are assigned a mutually orthogonal digital signal composed of chips - Used by 3G / UMTS - Chip rate much higher than bit rate (256 chips/bit) - Bandwidth only used when actually sending - - All radio’s aren’t compatible because of different frequencies, different types of multiple access, different modulation … This is why WiFi and Bluetooth are different and one can’t communicate with the other. Internet of Things - What is IoT? - Ubiquitous Computing with a focus on objects - Computing is distributed into the environment, and into physical objects - A happy convergence - Networking devices, sensors, actuators, becoming prevalent, small and cheap - Internet connectivity becoming integrated into everyday life - Cloud platforms for storage;APIs for data collection - Smaller, lower-cost, computing devices - Categories of IoT products: - Personal - Smart toothbrush, Fitbit, Smart scales, Smart baby monitor, Blood pressure monitor etc… - They communicate over bluetooth or WiFi - Home - Smart Lights, Smart plugs, Smart thermostat, Smart hoover (Eufy) - They communicate with WiFi or other standards such as ZiGBee etc… - Urban - Smart bins (notify when full), Smart bike lock etc… - Industry - Beacons and stickers, Workplace occupancy (Condeco Sense), Farm sensing equipment - Can use 3G, long-range UHF, GPS etc… - Ambient Devices - “Good Night Lamp”, “Little Printer” - thermal printer, printed articles etc like a fax machine Challenges of IoT - Standardisation - Associations, standards bodies, governments, tackling standards issues: fragmented and slow - Brands trying to accelerate the commercialisation of the IoT - “We can deliver the benefits of IoT only if all sensors can talk to each other” - (Samsung Electronics CEO) - Big Data - IoT devices generate a lot of data - How do we choose which data to keep? - Balance of data vs analysing data and discarding (see E dge computing) - How will this affect data centres and server technology? - DataSecurity - Certification and regulation needed for technology:especially when health related - Consumers need to be convinced that their data is safe from misuse or theft - IoT devices are generally unattended, easy to physically attack, easy to eavesdrop on - Limited energy/computing capabilities for encryption - Connectivity - Security:How do we encrypt traffic, or ensure that ports aren’t vulnerable - Power:IoT devices need to last as long as possible on as little battery as possible - Reliability:What happens if there is no WiFi, LPWAN or cellular coverage? Communication Choices - WiFi + Easy to integrate with home networks + Bandwidth and security - Higher power - Bluetooth + Available on phones/tablets/laptops + Some existing devices like speakers etc… - Short range - ZigBee - Protocol over 802.15.4 layer at 2.4GHz or /868/915 MHz - 64 bit addressing - Payload up to 104 bytes - ZigBee can have different network topologies (Always need 1 ZigBee Coordinator) - Star → 1 Coordinator, Rest are ZigBee devices - Mesh → 1 Coordinator, Many ZigBee Routers tightly connected, with Devices connected to the Routers - Cluster Tree → 1 Coordinator, Many ZigBee Routers only connected to the coordinator;Devices connected to Routers - 6LowPAN over 802.15.4 radios (Used in Ikea Tradfri) + Low power radios (typical 10mW) + E xcellent integration with internet + Gains IPv6 Characteristics + Mesh networking (RPL - Routing Protocol for Low-Power and Lossy Networks) + Can use 2.4GHz or 868/900 MHz - Need a gateway/hub to LAN/WAN - Sigfox - Ultra Narrow Band (UNB) cellular-style - 868/915 Mhz - Less than 25mW - 100 bits per second, slow - Range ~3-30 km - Data package provided by an operator - Up to 140 messages per day - Payload is only 12 bytes - Can transmit 4 messages of 8 bytes to the device each day - NB-IoT → Narrowband-IoT - Part of cellular/LTE Cat NB1 - 700Mhz, 800Mhz, 900Mhz - 200 kbps approx - Promise wide coverage - LoraWAN™ - Wide area low power network using gateways - Based on stars - gateways link together - Up to 50kbps, uses ISM 868/915 Mhz bands - Lots of security mechanism - Proprietary PHY layer (Semtech) - SS chirp modulation very robust - - Architecture of embedded IoT - Handling Data - The Things Network → Mainly for LoRaWAN - Mqtt.org → IBM’s lightweight communication protocol for IoT devices - A publish / subscribe model - Lightweight - Tend to use a message broker: - - “Topics” published to broker, which others can publish or subscribe - Xively.com → Data storage and visualisation - Hypercat.io - Developing a new standard for secure IoT interoperability and creating commercial products - HyperCat is a hypermedia catalogue format designed for exposing information about IoT assets on the web - The Thing System → Trying to pull together IoT devices to allow intercommunication and IFTTT type rules running locally - IoT should be more than networked devices pumping data - For privacy, data and decision making should operate locally within the home - IBM Bluemix - Cloud platform - MQTT upload from devices - Gains lots of analytics from IBM cloud - IoT Architectures The hardware usually has a set of “typical” elements which you would expect to find in any IoT device, such as: - PSU → Switch mode regulator - MCU (Microcontroller Unit) → ARM Cortex M0+ - Coms → Radio transceiver - Power source → Battery - I/O → Temperature, Humidity, Power Switch, Battery Voltage. (Sensors, actuators) - Storage → Flash A lot of the architecture depends on the MCU family - Simple MCU + transceiver? - E.g. STM32 MCU plus separate transceiver - System On Chip with many integrated peripherals - Atmel SAMR21 has ARM Cortex M0+ and AT86RF233 radio, usb, crypto, DMA, 32kB SRAM, 256kB flash - ESP8266 based systems include WiFi and Bluetooth - The MCU (Microcontroller Unit) might come with extra features, or it may be very simple - The MCU contains a processor, memory, I/O and possibly more on a single chip Internet connected things - They could have a full internet protocol network connection to/from the internet - Many systems need a gateway to the internet - Communications hub, border-router or gateway links low power hardware to the outside world - Gateway is often more powerful linux-based hardware - Certain things may not use IP (e.g. LoRaWAN, BTle) Basic software elements - Cloud - User interface - Data storage - Data processing/analytics - Access mechanisms - Network - Internet/GSM/communications network - Can be IP based or something simpler that eventually is IP - Security mechanisms - Fog/Edge - Data processing and/or decision making in the node, border/edge node or even cloud - Edge node can be the border to the main internet and provide data services - Cache is common to reduce traffic to the Objects - Objects - Object behaviour code - Coms/network stack - Data storage - Power management (unless in OS) - OS/Drivers - Operating System or Bare-Metal - Hardware abstraction layer - Networking - Security/Encryption - I/O interfaces - Sensor drivers - Timers, RTC functions - Power supply functions Networks - WiFi/Ethernet - Low Power Wide Area Networks - Low power IPv6 networks - Star - Meshes DataProtocols - Every system needs to use a data protocol - The protocol will describe the data and mechanisms - E.g. GET, PUT, POST, DELETE - RESTful - Possibly publish-subscribe - E.g. MQTT (tagged data streams) - Lots of different companies / groups have described IoT architecture… lots of ways to do it. - E.g. IBM, CISCO, Microsoft, ARM - Azure: - - IBM - - - CISCO - - W3CWeb of Things - Overall, there is not a single architecture. There are many different ones, each with different strengths to learn from. Low Power WANs (LPWAN) - LoRa modulation (LoRa → Long Range) - SS Chirp modulation (quite broadband and resistant) - ISM 868/915MHz Frequency - Proprietary PHY layer (Semtech) - Low data rate simple low level links - 0.3 - 50 Kbits/s data rates (more in USA) Characteristics of LoRA - Spread spectrum and chirpdesign - High immunity to interference - Long range due to high sensitivity - Doppler resistant – good for fast moving things - Multipath resistant – better in urban environment with lots of reflecting surface - Scalability – to lots of nodes transmitting on the same frequency - LoRa has a spreading factor (SF) - A longer sweep makes it more robust, but slower - E.g. SF7 → SF12. - SF7 would have higher data rate at same bandwidth compared to SF12 - SF12 would have higher receiver sensitivity - SF7 would consume less power (higher battery life) - Devices can be set up to use a lower SF if the range is OK. - - Larger spreading factor = longer time to chirp - Semtech Devices - Proprietary PHY (Physical) layer - These dominate the LoRaWAN market - SPI (Serial Peripheral Interface) on Semtech: - ~5.6 Kbits/s - 100mW - ~150mA peak TX - Range:multiple KM - £3.50 LoRaWAN Architecture - Wide area low power networking using gateways - Based on stars - gateways link together - Up to 50 Kbps, uses ISM 868/915 MHZ bands - Lots of security mechanisms - Proprietary PHY layer (Semtech) - SS chirp modulation very robust LoRaWAN Gateways Good ones – typically around £2000 - Multiple RX/TX antennas for optimum performance - Built-In GPS for precision timestamping - Enterprise level support - No reliance on open source software - Comes boxed up and ready to go!! Cheapones – Can get for £65 ish - 8 channel reception - Available from RS Components - Poorer wireless performance compared to outdoor base-stations - Not waterproof - WiFi connectivity unsuitable for remote locations (E.g. rooftops) - Easy to obtain and used, come pre-set up to work with The Things Network Channels and Restrictions - In the EU, LoRaWAN uses the 868Mhz band - There’s some restrictions on this, mainly a limit on how much bandwidth a single application can take up - This is implemented with a duty cycle implementation Law: The centre frequencies for different regions: - EU → 863-870 Mhz (Also imposes max duty cycle) - USA → 902-928 Mhz - China → 779-787 Mhz and 470-510 Mhz Modulation and Data Rates - 125, 250 or 500kHz bandwidth - In EU the settings are as follows: Rate Config bit/s Max payload (bytes) DR0 SF12/125kHz 250 59 DR1 SF11/125kHz 440 59 DR2 SF10/125kHz 980 59 DR3 SF9/125kHz 1,760 123 DR4 SF8/125kHz 3,125 230 DR5 SF7/125kHz 5,470 230 DR6 SF7/250kHz 11,000 230 DR7 FSK (Freq Shift Keying - Not LoRa) 50,000 (50kbps) 230 Duty Cycle Limitations on LoRaWAN - Can’t just keep sending packets - Have a limited time-on-air - Large packets less frequently, or smaller packets more often. E.g. - 10 byte packet every 30 sec - OR 250 byte packet every 10 minutes LoRaWAN Classes (not toofussed) - Class A - End device transmitted message, and receives a response (or confirmation) in one of two downlink receive windows. (The devices will only accept the responses in the windows, otherwise it will be sleeping and not listening. If confirmation is received during first window then second one isn’t opened) - E.g.: - - First case:no response received. Second case:response received in the first window. Third case:response received in second window - Class B - Adds scheduled receive windows for downlinks, meaning the end devices does not have to transmit first to get a response. (These still have the same downlink feature as class A’s, but add a period that it is listening for transmission to it. This requires the devices to be time synchronised, using periodic beacons) - Class C - End device a always listening, apart from during transmission Class A consumes the least energy, Class C consumes the most Examples of LoRaWAN enabled devices: - Water leakage detection, Other detectors - Water metre - CO2 tracker - Pressure tracker - Streetlights Variable DataRates = Variable power consumption(DR_SF7→ DR_SF12(lowest)) Devices IDs - Devices use a 64 bit DevEUI Identifier (Device Extended Unique Identifier) - AND an application ID:AppEUI - When it joins a network it also gets a dynamic 32 bit DevAddr Frame Counter - Increments each time a packet is sent - Network and device reject counters that are lower than expected - Helps to protect replay attacks LoRaWAN and The Things Network work well together There is a LoRaWAN gateway on the university roof !! The Things Network - TTN acts as a broker for LoRaWAN base station control and data transfer - A variety of integrations available. Receive your data over MQTT or HTTP/S Webhooks, or use an integration like IFTTT - Data loss when internet connection is disrupted or servers under maintenance. No SLA - Access to combined data of over 65,000 base stations world wide. Provision an app in Nottingham and have it work in Southampton, Cambridge or anywhere with coverage. - If coverage doesn’t exists, you can provide it for just the cost of a gateway. Connect to TTN? - Get TTN Network ABP keys - Setup radio - Generate and encrypt packets - Radio TX operation Sigfox (Competitor to LoRaWAN) Worse than LoRaWAN - UNB (Ultra Narrow Band) cellular-style - 868/915 Mhz - Less than 25mW - 100 bits per second (slow) - Range ~3-30 km - Data package provided by operator - Up to 140 messages per day - Payload is only 12 bytes - Can transmit 4 messages of 8 bytes to the device each day Weightless (LPWAN) - Operates in ISM band (868 Mhz) and TV white space - Parts of the radio spectrum allocated but not actually used - Intended for long range M2M communication - 5km range - Aims for “10 year battery life” - “$2 chip” NB-IoT (Narrowband-IoT) - Uses LTE frequencies and GSM towers - 700 Mhz, 800 Mhz, 900 Mhz with slightly better coverage than “normal” GSM - Standardised in 2016 - 200 kbps - Low cost per sim-card Nano-satcoms - Nano satellites are cheaper to deploy and are emerging as a possible LPWAN channel - Swarm: - $5/month for global coverage - 750 packets/device/month - 192 bytes/packet - Kineis: - 401 Mhz - 7mm chip - One 30B message/hour with 3000mAh battery lasts one year MQTT and CoAP - MQTT → MQ Telemetry Transport (publish-subscribe, machine to machine network protocol) - CoAP → Constained Application Protocol (smaller HTTP) MQTT - Designed to be smaller packets & less overhead than HTTP - Messages are published to a broker - Clients subscribe to data streams - MQTT uses TCP (not UDP) - Example: - MQTT Topics - MQTT topics are hierarchical - Example: - /house - /house/room/main-light - /house/room/side-light - Subscribing to house will include everything under house - Can also subscribe to something using wildcards: - /house/+/main-light MQTT for Sensor Networks MQTT-SN (2007) - Keeping a TCP connection open between a broker and a node is not always sensible - MQTT-SN uses UDP - Spec is quite complex and is not widely adopted - ECS/Physics Labs use MQTT for sensors in their laser: - - Example of JSON data sent over MQTT - - The data is raw, which helps to minimise software changes to the sensor network - ‘Hardware-id’:‘raw value’ CoAP - Efficient in low power IoT systems (longer battery life) - RESTful - as familiar as HTTP - Easy to interop with the web - Low resource devices - Low memory footprint - Basic packets should fit in a 802.15.4 frame - Defined in RFC 7252 CoAP features - A more modern lightweight design than MQTT - Prefers UDP - Binary format for protocol - DTLS security option - Block transfers - Resource discovery - Push notification - Cache model - Multicast support CoAP and the Web (of Things) - - Web of Things describes a set of standards for the interoperability of different IoT platforms and application domains - Translationbetween CoAP and HTTP CoAP header - Version (e.g. 01) - Type (e.g. 00 confirmable) - Tkl:Token length - Code is method (1-10), e.g. GET, or response code (40-255) like HTTP - ID helps match messages (response is the same) - Token is used to match responses - Option can mean payload is a URL string - Payload can be anything (up to 139 bytes) - Options Header - - Defines the content-type, URI etc… CoAP request examples - - The response ACK can contain the payload - Can send confirmable request or non-confirmable request - The confirmable bit deals with packet loss - - The client can resend a request if it didn’t get an ACK in the timeout - ! Use of message ID to keep track of responses - Slow responses - - Can send an ACK immediately, and then the payload later - Useful in scenarios when the request requires the CoAP server to load up a sensor / do a task which takes a long time CoAP proxy/cache - - This allows nodes to sleep and the proxy can reply with cached values Observation - - Nodes can push updated values Block Transfers - - Larger data blocks can be sent in chunks and re-built at the client - This is UDP so it is fast but packets can be lost Resource Discovery - - E.g: - - CoRE Link Format is a standard for defining resources - So IoT objects can be added and their resources discovered automatically - Nodes can POST their CoRE data to a Resource Directory for example - And can update it with a PUT or DELETE Multicast - - Get .well-known/core?rt=light - Can be a query multicast to the devices - The ones with a light resource can reply describing their resource - You cold then turn on all lights with one message Using CoAP - Libraries exist for various languages Payload - JSON can be used where power and bandwidth are OK - Very human readable - Easier to debug - Is that needed? → BSON is a binary format, so smaller but isn’t a standard - CBOR is a binary format which can do the same job (RFC7049) - Standard based on a JSON model - No fixed schema needs to be shared (unlike Google protocol buffers, although these can be very small) WiFi & WWAN Wi-Fi - IEEE (Institute of Electrical and Electronics Engineers) established the 802.11 Group in 1990 - Originally called “Wireless Fidelity” - Designed as a wireless ethernet replaced - Set of standards that cover physical specifications (PHY) and MAC for Wireless Local Area Networks (WLANs) - 802.11 sits in the Network Access layer of the TCP/IP model - - WiFi makes up a lot of the internal traffic - Nowadays, there are access points everywhere to get good signal - WiFi isn’t that good… lots of interference and humans absorb the RF - Mesh Systems are needed to get good WiFi, push out as much WiFi for you as you can Standards - How has WiFi gotten faster? - Better modulation and spectrum range - DSSS to OFDM, OFDM with more subcarriers and now OFDMA for WiFi6 - Wider channels - From 20 Mhz to 40 Mhz & 80 Mhz (802.11.g > 802.11n) - To 80 Mhz & 160 Mhz (802.11ac and 802.11ax) - Better spatial performance - Beamforming and MIMO/Mu-MIMO - “Better” digital modulation - From BPSK, QPSK and 16/64-QAM (802.11g) - To 256-QAM (802.11ac) and 1024-QAM (802.11ax) DSSS - Direct Sequence Spread Spectrum - Spread across the frequency domain - Send a wide wave continuously - but may lose some of it! - Redundant bits of data (chips) added to the representation of 0’s and 1’s - Spreading ratio:the ratio of chips to data - the more chips the more immune to interference - - - DSSS:1 to 2Mbps - HR-DSSS:High-Rate Direct Sequence Spread Spectrum - Allowed 5.5 and 11Mbps FDM - Frequency Division Multiplexing - Multiple transmitters transmit over multiple frequencies simultaneously - - Guard bands are used between each frequency to avoid signal overlap OFDM - Orthogonal Frequency Division Multiplexing - Adding Orthoganlisms - - Data transmitted in parallel in multiple carriers - Subcarriers are orthogonal to each other - The peak of one subcarrier coincides with the null of an adjacent subcarrier - The harmonices overlap in frequency, cancelling out interference - creating “nulls” - Carriers can be densely packed, saving bandwidth - - Comparison - DSSS - Uses the entire allocated frequency - Lower in throughput - OFDM - Frequency division multiplexing - Sends the signal using multiple frequencies - Allows for a higher data rate OFDMA - Not every packet of data being sent or received will consume the entire available bandwidth - Separating slices of time and sub-channels between users - We can now send traffic to multiple clients per stream - Increased efficiency for short data frames - - Similar to cellular technology - - Beamforming - Focus RF towards a client - Targets medium range → isn’t needed at short range, and long range it isn’t effective - Introduced in 802.11n - Didn’t work too well, wasn’t standardised - Stardised in 802.11ac MIMO - Multiple Input and Multiple Output - Exploits multipath propagation - A single pair of devices can send / receive multiple data streams with different coding - Multiple antennas for multiple streams - Combine data streams arriving from different paths and at different times to increase data rate - 802.11n supports up to 4 streams - 802.11ax supports up to 8 streams - Mu-MIMO - Multi-User MIMO - Parallelises for multiple clients in the spatial domain - No more taking turns! - 802.11ac supports downlink Mu-MIMO for up to four clients - 802.11.ax supports downlink and uplink Mu-MIMO Digital Modulation - It’s all about using the spectrum efficiently - Send more data in less bandwidth - From QPSK (4-QAM) to 256-QAM - With better radio equipment we have higher sensitivity - Drop speed as distance / noise increases - Can be really fast when close but slow down when further away (to account for noise) Multiple Access - WiFi is a shared medium, requiring multiple access - Carrier-Sense Multiple Access - Ethernet:CSMA/CD - Detect collision and retransmit - Collisions don’t happen much, if all, in switched networks - WiFi:CSMA/CA - Reduce the possibility of collisions in the first place - Make sure the channel is clear before sending a packet - Or wait and try again - CSMA/CA - Uses Multiple Access with Collision Avoidance - A sends an RTS (ready to send) to B - B responds with a CTS (clear to send) - Any station hearing the CTS can’t transmit until the message has been sent - Propagation Effects - What you send is not what they receive - Ideally, signal travel in a straight line from transmitter to receiver - Things get in they way: - Reflection:Bounce back and multipath effects - Diffraction:Split into secondary waves - Scattering:Diffusion in multiple directions WiFi Bands & Interference - WiFi also competes with over usage of the 2.4 and 5GHz bands, such as: - Microwaves, Bluetooth, Cordless telephones - Radar, Satellite comms etc… 2.4GHz - Uses 2.4GHz (UHF) ISM (Industrial, Scientific and Medical) band:83.5 MHz of spectrum - Band is divided into 14 22MHz (or 20MHz) channels (depends on where you live) - Channel separation is only 5Mhz - - Availability of channels depends on national rules: - Japan → All 14 channels - Spain → only channels 10 and 11 - France → Channels 10,11,12 and 13 - UK → All channels except 14 (2400 - 2483.5 MHz) - 100mW EiRP (Effective Power) - US → Channels 1 to 11 - Access points using the same (or close) channels will interfere with one another - Only three channels are completely free of overlap (22MHz DSSS) - US → 1, 6 & 11 - UK → Above & 2, 7 & 12 and 3, 8 & 13 - Four non-overlapping 20Mhz channels with OFDM - UK → 1, 5, 9, 13 - Only two “channels” for 40MHz-wide 802.11n - UK → 1-5, 9-13 5GHz - 5GHz (SHF - Super High Frq):Three “bands” in the UK - A:5150-5350 Mhz (indoor only, 200mW) - B:5470-5725 Mhz (indoor/outdoor, 1000mW) - Must be using with dynamic frequency selection (avoid interference to radar) - C:5725-5850 MHz (indoor only, 200mW) - Licensed 5.8 GHz WiFi can go up to 4W outdoors for fixed links - 5GHz channels - More non-overlapping channels - Shorter transmission range - Channels in UK regs: - - 5GHz has worse penetration than 2.4GHz - Inverse square law → We have double the power, but we lose more - Double the frequency, quarter the range for a given TX and RX power - Antennas can be smaller, so they can have higher gain - 5GHz can interfere with weather radar if set up incorrectly WiFi 6 - 802.11ax - “High Efficiency” wireless - Improve efficiency in dense environments - 2.4GHz, 5GHz and (provisionally) 6GHz - 1024-QAM - 25% increase in PHY data rate compared to 256-QAM DFS - Dynamic Frequency Selection - normally needed in band B 5GHz - This is why most 5GHz only operates in band A so it doesn’t need to bother with this DFS - Avoids interference with radar by listening for radar activity and avoiding occupied channels - Can broadcast a channel change event if radar is detected after initial monitoring - Not a good user experience - Adds cost and complexity - Slows down initial boot on relevant channels - Susceptible to false triggers that boot users off channels Less Common Wi-Fi bands - 6GHz (802.11ax) – “WiFi 6E” 5925-6425 MHz - 250mW indoor, 23mW outdoor - A new allocation to open up more of the RF space - 60GHz (802.11ad/ay) – Could be useful for VR? - 802.11ad - “WiGig” up to 7Gb/s (2012) - Useful for very local networking - Never took off, “ahead of its time” - 802.11ay - Short range, high throughput - 20-40Gb/s - More MIMO streams - 900MHz (802.11ah) – “WiFi HaLow” - Long range, Low-power - Other bands in other countries … Target Wake Time - WiFi is not very battery friendly - Why we have 802.15.4 - LR-WPAN (Low Rate, Wireless Personal Area Network) - Old method (802.11b): - Clients sleep between AP beacons - New method (802.11ah) - Clients and AP negotiate when a client can access the spectrum. Clients can sleep more! - Therefore, useful with IoT and sensor networks. Battery powered devices Spatial Reuse with BSS Colouring - Helps to maximise network performance in dense environments - Colour coding shared frequencies - Analogy:goes from 2 people in same building can’t talk at the same time to two people in the same room can’t talk at the same time - Contained with the PHY header (between device + network) - Every device associated with an AP inherits its colour - Allows better decisions to be made on how to handle interference - If the colour is the same, delay … - If colour is different + signal is weak, we can transmit - WiFi 7 - 802.11be - Built upon 802.11ax. Aiming for up to 40GB/s - Better support for real-time applications (IEEE 802.1Q) - Better coordination between APs - Increased spatial streams - 2.4, 5 and 6GHz bands - Enhanced OFDMA - More MIMO - Final version in 2024? Security - WEP → Wired Equivalent Privacy - Use key to generate pseudo-random keystream - 128 bit WEP - 24 bit initialisation vector - 26 hexadecimal characters (104 bits) - - WPA→ Wi-Fi Protected Access - Improvement over Wired Equivalent Privacy - 128 bit key - 48 bit initialisation vector - Temporal Key Integrity Protocol - Dynamically changes the key - Improved message integrity check - Under WEP, a known message can be altered without being decoded!! Low Power WiFi - Example:ESP8266 - Integrated TCP/IP stack - Can power down to 10µA - Needs good power supply! - Just use 3V Tx Rx to link-up WWAN (UMTS) - Wireless Wide Area Network - Mobile Phone standards: - - There are lots of abbreviations here: - GSM (2G) → Global System for Mobile communications - GPRS (2.5G) → General Packet Radio Service - EDGE (2.75G) → Enhanced Data rates for GSM Evolution - UMTS (3G) → Universal Mobile Telecommunications System - HSDPA(3.5G) → High-Speed Downlink Packet Access - HSPA+ (3.5G) → High-Speed Packet Access (evolution to 4G) - LTE → Long Term Evolution - UMTS - Uses two spectrum bands for uplink and downlink - Base:2170-2210 MHz - Mobile:1920-1980 MHz - Uses QPSK for modulation - Uses CDMA to allow multiple access - Long range transmissions - 10-50 Km - High power (up to 1W) - Approx 250 min continuous talk time → 1200 mAh at 3.7V Summary Bluetooth WiFi UMTS Frequency 2.4 GHz 2.4 GHz, 5GHz 2170-2210 MHz 1920-1980 MHz Bandwidth 1 Mbps 54 Mbps 384 Kbps Range ~1m ~100m 10-50 Km Power 1mW 100mW 1W Low Power Medium Bandwidth Short Range Medium Power High Bandwidth Medium Range High Power Low Bandwidth Long Range - Using the phone networks - SMS or IP connection - Uses a lot of power - Bandwidth can be low if on GPRS - Start-up can be slow Bluetooth - Many are non-IP wireless systems - All require interfacing/drivers PAN - Short-range - Body area networks - Personal devices - Some standards: - Bluetooth - ZigBee - More emerging ones - Bluetooth has an open specification to enable short-range wireless voice and data communications - Cable replacement between small mobile devices - Early 1998 - Special Interest Group formed - Code name “Bluetooth” - Promoter Companies:Ericsson, IBM, Intel, Nokia and Toshiba - Bluetooth came from Harald I (Blåtard) ‘Bluetooth’ of Denmark - He unified previously warring tribes from Denmark Bluetooth Information - Open specification - Publicly available, royalty free - Can be used anywhere in the world - Multiple devices - Low data rates and low duty cycles - Typically less than 1 Mbit/s - Low power - Intended for battery powered devices Power - Radio transmission power - Class 1 - 100m at 100mW - Class 2 - 10m at 2.5mW - Class 3 - 1m at 1mW - Example: - Device with battery 270mAH at 2.4V - Operating at 1mW, 1mW = 0.001/2.4 = 0.4167mA average - 270/0.4167 = 648 hours or ~27 days - Typical applications do better - Low data rate / low duty cycle 2.4GHz Spectrum Band - Globally unlicensed (regulated) part of the spectrum - 2.4GHz ISM (Industrial, Scientific and Medical) - Interference must be anticipated and appropriately handled - Competes with 802.11 Wi-Fi - Aims to maximise bandwidth and minimise RF interference while operating at very low power. Bluetooth Radio - Divides 2.4GHz band in 79 channels - 1MHz per channel - Maximum rate about 1 Mbit/s - - Uses PSK modulation (Phase Shift Keying) Frequency Hopping - To reduce interference, transmissions frequently hop between channels - Communication divided into slots - 1600 slots per second - Each slot uses a different channel - Pseudo random sequence - Reduced RF interference - Power is spread across the entire frequency band - Security - In the case of bluetooth, the hopping pattern is known - Many military systems use frequency hopping for security Adaptive Frequency Hopping - A more sophisticated scheme is Adaptive Frequency Hopping (AFH) - Bad (marked unused) channels within hopping sequence are replaced by random good channels used in hopping sequence (version 1.2) - AFH reduces interference with WiFi competing for the same spectrum band - E.g: - - It detects the collision in the lower frequency, so it switches to using the less busy channels Multiple Users - Master and Slaves - One master may connect to up to seven slaves - No difference in hardware between master and slave - No slave can communicate directly with another slave - Other slaves can be parked (255 of these) - Master determines frequency hopping pattern and timing - Centralised control Piconets and Scatternets - Piconets (group on the same channel) can combine to form scatternets - ad-hoc networking - Example: - - Don’t regularly see this ^ Time DivisionMultiple Access (TDMA) - This leads to “contention-free” networking - - Some devices can use a lot, others use less. as seen below - Multi-slot packets - Can also assign 1,3 and 5 slots per frame in either direction (to or from slave) - E.g: - - Can interweave these with different slaves and different directions - E.g: - - (SCO = Synchronous Connection Oriented Link) Packets - Packets are comprised of the following: - - ACL = Asynchronous Frame Types - Bluetooth supports many different frame types depending on the application - SCO:Synchronous Connection Oriented - Real time data - Fixed slot in each direction - Slots are reversed - Not retransmitted - SCO Throughput - SCO Frame has 240 bits of data - 240 bits of data - 160 bits of data + error correction - 80 bits of data using R3 repetition code - Consider a single slave and master pair - Each gets 800 slots/sec - With 80 bit payload this is 64 kbps - Sufficient for digital voice communication - Can support up to three voice links per master - ACL:Asynchronous Connectionless Link - Packet switched data - Error correction using (15,10) Hamming code - Correct single errors - Detect double errors - Retransmission of failed frames - ACL Throughput (In slots not used for SCO, master can establish ACL links on a per-slot basis) - Maximum data rates are: - Symmetric Data: - 433.9 kb/s and 433.9 kb/s - Asymmetric Data - 723.2 kb/s and 57.6 kb/s and vice versa Extended Protocols - Bluetooth 2.0(2004) - Faster transmission speed - Enhanced Data Rate (EDR) - about 2.1 Mbps - Low power consumption - Bluetooth 3.0(2007) - Up to 24 Mbps but with a trick - Bluetooth used to initiate connection, then switch to WiFi - 802.11 used for link - Bluetooth 4.0(2010) or BTle (Async, UDP like capability) - Low energy - Bluetooth 5.0(2016) - High speed mode, location, more low energy - BTle (low energy) 4.0 - Designed for low energy devices (not voice) - Max 10mW, 1 Mbits/s - 128-bit AES encryption, signed data etc… - Profiles for health sensors etc - Notifications can be sent - Used for proximity sensing (e.g. 1yr bat life) - E.g. nRF51822 uses 2 µA in idle mode Beacons - Nordic beacons were used in CES for an indoor map on phone location - Beacons typically advertise every 100-1000ms - iBeacon Example - Device like a phone scans and gets: - - BTle - Generic Attribute Profile (GATT) - Host can read services and characteristics list from BTle node using the Attribute Protocol (ATT) - Only one host can be connected to a B Tle thing - but the device can suggest a connection interval - Example of BT GATT profiles - These are all given a unique ID and XML def - Alert - Battery - Blood pressure - Heart rate - Indoor positioning - Phone alert - Running speed/cadence - Weight - Etc… - Talking to BLE devices from Linux - Bluepy is one example 6LoWPAN & 802.15.4 IEEE 802.15.4 - Standard that covers physical specifications (PHY) and MAC for LR-WPANs - Low Rate - Wireless Personal Area Networks - 802.15.4 sits in the Network Access layer of the TCP/IP model - Layer 1 and layer 2 of the OSI 7-layer model - Same Working Group family as Bluetooth - Applications - Wireless/Environmental Sensor Networks - Industrial communications & control - Home automation - Health monitoring - Smart metering - Asset & Inventory tracking - Intelligent agriculture - Examples - Ikea Tradfri - ECS - Long range deployment:Mountain Sensing - Other Options - Basic concept → 10m communications range with 250 kbps transfer rate @ 2.4GHz - Intended to be low-cost and low-energy - Good for sensor nodes 802.15.4 Bluetooth GPRS/3G 802.11(WiFi) Application Monitoring and Control Device Connectivity Wide-area Voice & Data High-speed internet Battery Life Years Weeks Days Hours Bandwidth < 250 kbps < 24 Mbps < 100 Mbps < 1300 Mbps Range < 100m (2.4Ghz) Long ranges possible with other freq 100m (Class 1) 10m (Class 2) 1m (Class 3) Kilometres < 100m Advantages Low-power, low-cost Ubiquity, Convenience Range, Existing infrastructure Speed, Ubiquity History - First standardised in 2003 with IEEE 802.15.4-2004 - Supported 250 kbps transfer rate @ 2.4 GHz - Also allowed 20/40 kbps transfer rate @ 868/915 MHz - 802.15.4-2006:Enhancements & clarifications - More data rates at 868/915 MHz - 802.15.4-2011:Consolidation& clarification - Incorporated three amendments for 802.15.4-2006 - Reorganised to make amendments easier - 802.15.4-2015:More consolidation - Incorporated six PHY and one MAC amendment for 802.15.4-2011 - 802.15.4-2020:Latest and greatest - Incorporated two PHY and one MAC amendment for 802.15.4-2015 There are also amendments for the current standard: - Supported Freq & Data Rates - Incomplete … Device Types - PAN Coordinator:The network’s overall controller - Coordinator:Provides synchronisation services to other devices. Think router… - Full FunctionDevice - Can function as a PAN coordinator or coordinator - Can associate with multiple other devices at once - Reduced FunctionDevice - Cannot function as a PAN coordinator or coordinator - For very simple applications e.g. light switch or PIR sensor - Can only associate with one FFD at a time Network Topologies - Star topology - All communications are to/from the PAN coordinator - Peer-to-peer - All devices in range of each other can communicate directly - Basic of Mesh networking - N.B. 802.15.4 does not standardise routing - 802.15.10 defines some standardisation Addressing - Each device has a universal 64-bit address - IEEE registered MAC address - EUI-64 address - Can also have a short 16-bit address - Only valid within the PAN - Allocated by the PAN co-ordinator at association Frame structure - - Low complexity - PSDU is consistent across PHYs - SHR and PHR are PHY dependant PPDU:PHY protocol dataunit - - Preamble length is PHY dependant - O-QPSK modulation uses an 8-symbol, 4-byte preamble - BPSK modulation uses a 32-symbol, 4 byte preamble - ASK modulation uses a 2-symbol, 5-byte preamble - SFD:Start of Frame Delimiter - Lan:7-bit frame length - PSDU:Phy Service Data Unit PSDU - - General MAC frame format is used for data transmission - ACK frame, just contains frame control - Compared toEthernet (header) - 802.15.4 header - Ethernet header - ZigBee Standard - Sits above 802.15.4 - Specifies network layer and application layer - Facilitates Mesh networking and tree (multi-hop) networking - 802.15.4 is also used in: - WIrelessHART - Wireless Highway Addressable Remote Transducer Protocol - Intended for industrial wireless sensing applications - 2.4 GHz only - Mesh architecture - Self-organising, self-healing and time-synchronised - Species everything above the Network Access Layer - MiWi - Thread 6LoWPAN - IPv6 over Low power Wireless Personal Area Networks - IPv6 packets over 802.15.4 networks - Alternative to IPv4/IPv6 at the Internet Layer of TCP/IP model - Layer 3 of OSI 7-layer model (Network / Internet) - Allows IPv6 packets to be sent over 802.15.4 - Extrapolates IPv6 address from 802.15.4 address if possible - Smallest possible header is two-bytes - Compared to 40-bytes for full IPv6 header RPL - Rfc6550 (RPL - Routing Protocol for Low-Power and Lossy Networks) - Builds a Mesh network with 6LoWPAN - Works out routing over mesh networks - Multi-hop networks - - Creates tree-like topologies - Destination-oriented directed acyclic graphs (DODAGS) - An RPLinstance contains one or more DODAGs - Each node is assigned a distance-dependant rank - Further from DODAG root = higher rank - Range from the root node is used as the routing metric - Uses ICMPv6 for control messages Duty Cycling - RF comms use a lot of power … - Can reduce this by turning radio off when not needed - Not enough ContikiMAC→ Send and receive - - An asynchronous protocol, non-standard - Approximately 1% duty cycle - Relies on retransmission as beacons - “Works” at 2.4 GHz and sub-GHz (868 and 169 MHz) TSCH - - Time {Slotted|Synchronised} Channel Hopping - A synchronous protocol, part of 802.15.4-2015 - Essentially combines TDMA and FDMA - Each node gets a timeslot to talk to other nodes - Highly reliable (~99.9%) Decoding - 802.15.4 Header - - Need to decode the Frame Control to know the header format - Frame Control - 61DCis the Frame Control (The first 2 bytes, these 16 bits tell us the following) - Need to be careful of endianness (The direction in which bytes are read, not bits) - - It tells us this packet: - Is a data frame - Requires an ACK - Uses PAN ID compression - Is an 802.15.4 frame - Uses 64-bit source and destination addressing - From this we know it has a 21-byte 802.15.4 header Decoding cont… - - Destination address is: - c1 0c 00 00 00 00 0f ee - Source address is: - c1 0c 00 00 00 00 10 05 6LoWPAN Decoding - - 41 tells us that an uncompressed IPv6 header follows - Host-to-Host - - IPv6 header told us that a UDP header followed - - The Payload - - 70-bytes of header for 8-bytes of payload - The Reply - Same 802.15.4 header, just with addresses reversed - - - Compressed 6LoWPAN header ^ → only 2 bytes - 30 bytes for 28 bytes of payload IoT - Embedded systems need the stack (e.g. from RIOT-OS) - Need a border router to link to “outside” internet - Typically use CoAP on top Advantages of using 6LoWPAN - Existing internet tools are compatible - Ping, wireshark, firewall, routing - Devices can post data directly to servers - Addressing can be automatic - RPL provides dynamic mesh network - Mesh network allow hops to extend range - 802.15.4 underneath provides extra interoperability across hardware Connected home over IP - In 2019 a big group of industries started working with the Zigbee alliance - WiFi + Thread (essentially 6LoWPAN) and IP over bluetooth - Designed to integrate IoT with IP standard (at last!) - Uses a border router … - Thread - Uses 6LoWPAN - OpenThread is available and managed by Google - Thread is like Zigbee, but is IP-addressable Summary - 802.15.4 specifies the physical and MAC requirements - Different frequencies and data rates supported - 6LoWPAN and Zigbee sit on top of 802.15.4 - 6LoWPAN is at the internet layer. Standard TCP/IP above - Zigbee is Internet & Application layers - Great for low-power IoT devices Sensor Networks Wireless Sensor Networks - Autonomous networks of low-power wireless sensors for applications including: - Environmental monitoring - Security and surveillance - Health Monitoring (PANs) - Rapid response/disaster WSN research and design - Low power hardware, networks and algorithms - Robustness - Self-configuration - Autonomy - Data access and interoperability - Power aware behaviour - Operating Systems - Standards - Security Applications such as: - Bird nest monitoring - Volcano monitoring - Agriculture - Forest monitoring - Argo floats (In the sea) Power-Aware Routing - WSNs can often route to prevent overloading one node or cope with breakdowns - Whole system lifetime is important - Glacsweb base station on a glacier has options - Wifi to local cafe as main route - Mobile phone GPRS as backup (less power efficient) - - Other considerations? - TX vs RX power use - Start-up time from sleep/off (typically ms) - Media Access Control (MAC) in dense nets - “Overhearing” wastes power - Single point of failure with one base station/sink List-Sleep media access protocols - Typical MAC protocol - May need synchronisation - Can sometimes use a lower power preamble listen - Example:ContikiMAC Multi-hop Routing - - Power required to transmit in a single hop: - - Power required to transmit in n short hops: - - (Very rough maths) Low-Energy Adaptive Clustering Hierarchy (LEACH) - Sometimes single-hop will be better than multi-hop and vice versa - While total energy use is important - We should worry which nodes will live longer - Low-Energy Adaptive Clustering Hierarchy - Form clusters of sensors, around a local temporary cluster-head - Environmental Sensor Networks - Comprises an array of sensor nodes and a communications system which allows their data to reach a server - Enable data that would previously be impossible to collect to be gathered - Send data regularly without human intervention - Typically wireless - Battery powered - Might have: - Solar - Wind generation - Other energy harvesting - Examples of these networks: - Iceland Overview - - Glacsweb Probes - 173MHz radio transceiver - Sensors:Temp, Press, Strain, Conductivity, Accelerometer - Our own Gwpacket and protocols - - These probes placed in ice! - Connecting to a base station - Large scale WiFi!! - Speed saves time and energy (but uses 500mW) - Off the shelf components - Very directional for long ranges!! IoT and standards - Emerging standards mean IP can be used everywhere! - Much more interoperable and “future-proof” - Communication - Always on - Gateway tries to pull every hour - Each node has a global IPv6 address - Can be pinged to check if connected CoAP - Constraint Application Protocol - Like a binary HTTP/web protocol - Uses UDP packets - less network traffic - Low power - Nodes can reply to URI requests - GET coap://[2001:630:d0:1000::d01e]/temperature - Can be used to discover what nodes can do? - /.well-known/core → descriptive resource Gateway/Border Router - Mini ITX running Ubuntu - Nodes connected over USB - Estate’s Satellite ISP - Unreliable in bad weather - SIXXS IPv6 tunnel - IPv6 home over IPv4 IPv6 IPv4 - The problem - IPv4 doesn’t have enough addresses for all computers - We have been forced to use workarounds, NAT - 3.7bn useable address - Around 46bn connected devices in 2021 - will only grow - IANA gives out address blocks to local registrars → Ran out in 2011 - The local registrars are running out too - In 2016: - - Certain spaces, such as 0.0.0.0 and 127.0.0.1 are reserved / multicast Solutions? - Address conservation - NAT → Network Address Translation - 1 Global Address shared between local devices - Proposed address release (e.g. 0/8, 127/8, 240/4) - Therefore need client updates… Not good. Legacy software breaks - Address recovery → Buyback / get companies to give up - CGNAT → Carrier-Grade NAT - ISP subnet becomes a large private network - Home routers are assigned private IPs - There is then double NAT, NAT from carrier and NAT from home network - Breaks end-to-end IP connectivity - Limites / Removes the ability to port forward - Stateful… ISP Networks has to keep state of all connections - Everyone gets punished by public IP abuse - Security and privacy implications - Problems… Scalability, Reachability, Performance - Doesn’t solve the actual problem - toob uses this … IPv6 - 128-bit addresses:3.4x1038 addresses - Represented in colon hexadecimal format - Leading 0s in block can be omitted - Single set of repeated 0 blocks can be replaced by “::” - - Subnets: - - Multicast replaces broadcast Crunch Time - When IPv6 is needed to access all parts of the internet - Some ISPs only give out IPv6 - Some sites/services are only available on IPv6nD Have to change the IP layer - Why don’t we use it? - It isn’t “needed” - There are workarounds - Some ISPs are stubborn… don’t want to spend the money - Training, new infrastructure / hardware - New issues, there’s no urgency Motivation - IPv4 exhaustion is not the only reason - Direct addressability - End-to-end global addressing as intended - No more NAT - Less complex networks - So faster! Less latency Misconceptions - Puts the current infrastructure at risk - IPv6 can independently co-exist - Insecure - NAT isn’t security - Cost - Cost savings and long term investment - ISP don’t offer it, so we can’t do it - Transition mechanisms - If it isn’t broken - You’re going to need it eventually - IPv6 embeds MAC address - Nowadays it’s all random Challenges - IPv6 support - Network operators - Content providers - Software developers - Hardware developers - Chicken and egg problem, customers don’t have it so we don’t need it - Urgency - Temporary workarounds “work” Support? - Governments need to be on board - UK MOD → ICT they buy will be IPv6 compatible - USGv6 Program - Leadership to drive transition - Commercial and public sector networks - International co-operation - Encouragement Usage? - UK above 40%, India above 70% - In India → ISPs required to provide IPv6 Deployment What do we need? - IPv6 address space - Routing - Firewalling - DNS that serves IPv6 - IPv6 address allocation mechanism - DNS and IPv6 - Pretty much all DNS implementations support IPv6 AAAA records and IPv4 A records - IPv6 address allocation - SLAAC → Stateless Address Auto-Configuration - DHCPv6 is another way - Provides a managed way to allocate addresses - DHCPv6 prefix delegation makes automated sub-allocation of IPv6 address space possible - Common scenario: - DHCPv6 with PD from the ISP to your router - Router allocates addresses internally with SLAAC - DHCPv6 is a mix of multicast and unicast traffic, link-local and global addresses - Client sends a SOLICIT over multicast - Server responds with an advertisement of an address directly to the client - Client sends a request for the advertised address over multicast - Server sends a reply confirming the address allocation DUIDs - DHCPv6 Unique Identifier - Used to identify a host to the DHCPv6 server - IPv4, normally used MAC address - Four different types … - RFC 6939:Client Link-Layer Address Option Dual-Stack Deployment - IPv4 and IPv6 on same system - Requires IPv4 address space - Can use NAT/CGNAT with global IPv6 addresses (IPv4 is slower) - Need to secure (firewall) both protocols - Layer 2 security → RA guard (Router Advertisement) Applications in Dual Stack Environments - DNS returns both records (4 and 6) - Applications choose when to use 4 or 6 - Current preferences is IPv6 if available - “Happy Eyeballs” give a (fast) fallback to IPv4 if needed - Applications need support IPv6 - E.g. changing socket from AF_INET to AF_INET6 - IPv4 addresses map into the IPv6 address space - IPv4 applications work without changes Dual-Stack bad? - Two networks in tandem - More issues - Double IP config - Overhead for DHCP, firewall - More hardware usage - Doesn’t actually free up IPv4 address space… still need both Issues IPv6 Only - IPv4 only apps don’t work - VPN clients connecting to IPv4 gateways - Mostly dont work through NAT64 - Struggle with 464XLAT - Gateway accessible over IPv6 fixes this - Inconsistent OS support - Android doesn’t support DHCPv6 - Older windows don’t support RDNSS Deploying IPv6 - Can do an initial IPv6 deployment at the same time as a network upgrade? Hardware usually supports it - Deployment order? - IPv6 from ISP to your firewall - Roll out some test nets - IPv6 enable public-facing services - IPv6 enable client devices Smart-Home Home automation - Autonomous control of devices - Links between devices - Friendly outputs - Optional link to cloud for external visibility/control - Energy usage/generation - - Optimise use of low carbon energy Networks - Home networks can consist of multiple technologies: - Ethernet, WiFi, BT, ZigBee… - 6LoWPAN, Z-Wave Etc… (NFC & RFID) - Lora? Probably not - Many options from big companies - Amazon Alexa - WiFi, BT, ZigBee (Soon thread & matter) - Google Home - Apple Homekit - smartThings (Samsung) - WiFi, ZigBee, Z-Wave - Home Assistant - WiFi, ZigBee, BT (Thread & Matter) - openHAB - Iobroker - nodejs (fewer users) Thread & Matter - Thread - Uses 802.15.4 and 6LoWPAN - The basis of fully-IP low power IoT - Matter can use it - Routers provide joining & security - Leader is an “elected” router - End devices usually can’t route - Although some can be routers if needed - - Matter - Led by Amazon, Apple, Google, Samsung and ZigBee Alliance - Most recent IP-based infrastructure - Has certified products - IP-only using:WiFi, Ethernet, Thread - Onboarding with QR codes or BTle Home Assistant - Open source - Central control of IoT devices and information - Can be completely isolated from the internet - (Comparable to openHAB - Java based) - Can run on: - Pi3 or 4 (or other SBC, single board computers) - Low powered PCs - only needs small RAM or CPU - Linux is preferred - use VM if on other OS - Could use container (such as Docker) - then no “add-ons” which are very useful - Architecture: - The core interacts with us and devices - Supervisor manages the OS - OS/Linux provides environment - - How does it work? - - Integrations: - The interface and messages to/from devices - - There are many out of the box integrations, such as Amazon Alexa, HomeKit, etc … - ZigBee - Uses a USB coordinator - It links up all ZigBee devices - Example:Conbee - Onboarding - With hubs and others connected - It searches for anything with an “integration” - This could be on WiFi/ZigBee or whatever … - It also finds new devices while running (New devices discovered!) - ESPHome - ESO8266/32 device configuration (HomeAssistant only) - Allows a user to specify IoT device behaviour without programming - File can program the ESP32 with code to toggle a GPIO and present an on-press function called dehumidifier1 - - Automations - Can trigger actions based on values - E.g. officelight.turn_on if officelight_value < 50 - Triggers include: - Time, calender, MQTT, web-hook, mobile presence, RFID - Example condition: - - Database - Data can be stored in InfluxDB or SQLite/PostgresSQL - InfluxDB links well to Grafana - Grafana is an add-on for dynamic graphs, such as: - - Dashboards - Can put together views of activity/data/actions - Without coding - Works well with phone app - E.g: - IPv6 - 2 Tunnelling - Putting IPv6 packets in IPv4 (encapsulation) - Three main approaches: - 6in4 - VPN - Teredo - (Could also put IPv4 packets in IPv6) - Tunnelling reduces MTU, increases latency (if ISP has good routing) & can cause issues with GeoIP-restricted services 6in4 - “Protocol 41” in IPv4 header - Bolt an IPv6 header in front of an IPv4 - - Hurricane Electric Teredo - IPv6 in IPv4 UDP packets - Operates without cooperation of the local network - Only provides a single IPv6 address per tunnel endpoint - Uses servers and relays - Servers → Set up the connection, detects NAT configuration, helps establish a connection between Teredo client & relay, client will talk to server to keep connection alive - Relays → Forward traffic between IPv6 hosts and Teredo client (All the bandwidth goes through here) - - Teredo will get through firewalls (bad for security) - 1. ICMPv6 Echo Client > Destination via Server 2. Server forwards ICMPv6 echo to destination 3. Destination replies to nearest Teredo Relay 4. Relay sends Teredo “bubble” to Server 5. Server forwards Teredo Bubble to Client 6. Client sends bubble back to Relay (thus establishing a connection to the relay) 7. Relay forwards ICMP reply to Client. 8. Client can then start communicating with Destination via Relay. - Setup is slow… initial connections may take some time VPN - VPNs can tunnel IPv6 and IPv4 using TCP or UDP - Can do any configuration - Encryption overhead - Tunnelbroker.ecs uses OpenVPN to tunnel IPv6 to things NAT64 (RFC 6146) - IPv4 addresses embedded in a specific IPv6 prefix - 64:ff9b::/96 - Last 32-bits taken as the IPv4 address - - NAT64 gateway translates packets with the prefix to IPv4 - Chops off prefix, sends as IPv4 - Chop off IPv4, replaces with IPv6, and vice versa - Downfalls of NAT:slower, etc… higher latency DNS64 - DNS server synthesises an AAAA record for a domain that only has A records - Uses the defined prefixed (same as NAT64) - Combined with NAT64 for a full solution - But: - Breaks DNSSEC (security) - NAT64/DNS64 does nothing for IPv4 literals or for IPv4-only sockets - Google run public DNS64 servers - 464XLAT (RFC 6877) - Limited IPv4 connectivity across IPv6-only network - Two translators: - Customer-Side Translator (CLAT) → IPv4 to IPv6 (Stateless) - Provider-Side Translator (PLAT) – IPv6 to IPv4 (Stateful) - Stateful NAT64 translator - CLAT - Can run on client (or dedicated device) - - Commonly used on mobile data networks - (ISP has IPv6 network) Dual-Stack Lite (DS-Lite) - Native IPv6, tunnelled & NATed IPv4 (RFC 6333) - Downsides & pitfalls of CGNAT - Reduced IPv4 MTU - DS-lite encapsulation can run directly on a client device - Common deployment is to run DS-lite to the CPE router - Overall - There are lots of different transition mechanisms - Each mechanisms has its own benefits and pitfalls - Nothing is as good as native dual-stack - Some are close to typical NATed IPv4 connections - CLAT can make everything happy, makes IPv4 only sites (hard coded ones) work such as steam Network Security Network Attacks - Network attack has several distinct phases - Between 4 and 18 distinct phases - For exam, know about ONE model Cyber Kill Chain Model - Mandiant Cyber Attack Life Cycle - 1. Initial Reconnaissance a. Scope out target to find:IP addresses, Apps, Open ports, Versions, Services, Vulnerabilities b. Difficult to detect and protect against – blends in with normal traffic c. Security though Obscurity impedes this (delays it)… Something less connected to the internet is more protected (Less ways to recon) i. Disable default SSH banners and default error banners, reverse proxy for server to obscure software it is running d. Methods?: i. Port + Network scanning, Banner grabbing, Signature recognition, Google & Shodan ii. DNS brute forcing → Look for common subdomains to discover hosts/services (e.g. vpn.x, login.x, etc…) 1. Can use reverse DNS to find services (less feasible in IPv6 land 2. Some DNS lookup services exist. (E.g. bgp.he.net shows the first 1k reverse DNS entries for an IP range) iii. Dumpster diving (physical bins) → Orgs dispose of sensitive information in normal waste. Shredded documents may have credentials 1. Old IT equipment gets dumped, they are full of information or configuration which can be gathered iv. Social engineering → Sometimes you can just act friendly and ask for credentials. Phishing is even worse v. M in the M → No one knows it is happening. E.g. ARP poisoning, TCP hijacking, HTTP proxy, Network tapping 2. Initial Compromise → Aim:Execute malicious code on target system’s a. Can get someone to → Download malware from website, open malicious email, plug in a malicious USB stick b. Includes exploiting a publicly-facing vulnerability: i. Technical vulns - RCE, buffer overflow, SQL injection ii. Authorisation bypass/escalation iii. Application vulnerabilities c. Weak policy and processes i. Brute force, Password reuse, Excessive access, Access to unencrypted data/communication d. Defence is user education 3. Establish Foothold → Aim:Gain a level of access/control over target a. Install a rootkit/backdoor. b. Block the vulnerability so other attackers cant get it, only you. Or make more! 4. Escalate Privileges → Aim:Gain more control and access through more privileges a. Exploit privilege escalation vulnerabilities present on the system(s) b. Dumping and cracking hashed passwords or accessing password managers 5. Internal Recon→ Aim:Gain more understanding of target’s network/system a. Information that cannot be seen from outside (Step 1 but inside) b. Find the key files, file the names and roles of key individuals, what internal systems are used. Now you know a lot, and can social engineer better c. Attacker is an internal threat 6. Move Laterally → Aim:Gain more access to more systems a. Attack now has easier access to other systems in the network, and can spread b. Could gain GUI access c. There may be firewalls in the way (If a compromised web server is in a DMZ) 7. MaintainPresence → Aim:Establish persistent access a. A single compromised system with a single back door doesn’t guarantee long-term access b. Do more, compromise more systems i. More rootkits, more backdoors and different ones ii. More malware!!!!!! iii. Gain access via legitimate remote access services or corporate VPN 8. Complete Mission→ Aim:Achieve overall goal a. Attacker can now do what they came to do b. This may take weeks, months or years c. Attacker can maintain access for future use: i. More data to steal, to use as an attack platform for future attacks, to add a botnet Defending Against Attack - Defence is a continual cycle - Assessment - Protection - Detection - Response - No single magic bullet - Cannot be 100% secure!!! (LIES!!) New threats always come out, so nothing can be 100% secure Security Policies - Rules and procedures for people and systems accessing a network and sets out the responsibilities of those managing the network - Intended to ensure the confidentiality, integrity and availability of systems and information - Needs to set out the punishments for being bad Policy: - Should be: - Organisation-specific - Practical & enforceable - Regularly updated - Should encourage people telling you issues, not punish them for finding it and telling you - Should say who is responsible for fixing it - Don’t forget to: - Include processes for users to report security issues and incidents - Include details of how security incidents will be responded to and who is responsible - Define a password policy (Passwords don’t have a shelf life, don’t need to enforce changing them) Security Policies can be BAD! - Bad policies can encourage users to be less secure - If the goal of the policy isn’t understood - If it hinders their work, they may bypass it - Users who feel security is driven from the top-down are less likely to actively report incidents or suspicious events (They don’t feel a part of the solution) Users Problem? - User education and awareness can do a lot to mitigate the risk - Train users to recognise the threats: - Phishing, fake websites, malicious downloads - Educate users on what it can do to system if compromised, and the repercussions - I.e. why they shouldn't try to bypass the policies Ongoing Maintenance - Networks (and systems) need ongoing maintenance to maintain an acceptable level of security - Should UPDATE the devices regularly - Anything that connects to the network should be updated - Client/server OS patches - PC drivers, firmware and BIOS updates - Mobile device firmware - Switch/Wi-Fi AP/router updates - IoT/”Smart” device firmware updates Regular Auditing - Ensure that policy exceptions are still required - Are all those inbound firewall rules still needed? - Is that old server still needed? - Is software/firmware being updated? - Are users up to date with training? - Check network regularly. Look for red flags: - Unknown devices - Unexpected configuration changes - New WiFi access points/networks/BSSIDs - Regular penetration tests can be very insightful Incident Response - After an attack, a few minutes to think and get ready is better than diving into fixing it. The attack has already happened and effect has. So don’t rush into it and miss things - Good security policy covers incident response - Who is responsible for responding to it? - What actions can be taken autonomously and what needs authorisation? - Who an attack needs to be reported to? - Cyber Incident Response Cycle - Don’t ignore internal threats - People inside your network can be a threat - If you fire network admin, strip him straight away - Limit access - Receptionist doesn’t need admin access to a file server - Internal network segregation (firewalling & ACLs) - Consider first-hop security First Hop Security - New area - Defence against local/internal attacks - Specifically systems within the same subnet - Dealing with rogue responses (e.g. rogue DHCP, DNS, ARP, RA attacks etc) - The key:don’t pass on untrusted responses - E.g: - Cisco DHCP Guard - Only allow DHCP responses from known DHCP server switch ports - Easier to deploy that authenticated DHCP and certificates - RA Guard does the same thing for IPv6 RA IPv6! - Don’t overlook IPv6 security - Teredo can bypass firewalls and filtering - Modern hosts use link-local IPv6 on IPv4-only networks a lot. IPv4-only monitoring would miss this - IPv6 security is still new and changing - many vulnvs Make use of Reputation - IP/Domain reputation can improve security - Block or alert on access to DNS queries for: - IP addresses known for malware, botnets or spammers - Dodgy URLs, files, extensions, MIME types - Consider geographic IP restrictions - If all your customers are UK based - Can you throw away some dodgy Russian/Chinese traffic Detect Breach - You need to know before, this is where monitoring can help. Tim Chown 802.1X - Port-based access control, running at layer 2 - Pros - Prevents abuse within the local WiFi network - (Not admitted until authenticated) - No IP address used until authenticated - Supports periodic re-authentication - Encryption - Cache credentials - Supports v4 and v6 Networking Monitoring When do you know breach has happened? Have to monitor network to detect breaches Why Monitor? - Security - Policy compliance - Capacity planning - Troubleshooting and diagnostics - Problem identification What to monitor? - Traffic metadata - Traffic payloads - ARP/NDP tables - Routes - Switch port utilisation - Firewall logs - DNS entries & queries Network Flow Monitoring Collects: - IP source & destination - Protocol(s) and port - Packets count and data total sFlow is industry standard Is it useful? - Network flow monitoring can help spot anomalies e.g. - Build a profile of good/normal traffic - Spot out-of-profile or known-bad traffic - Can do this manually, but automation is good (Cisco Netflow) - Helpful after an attack for finding any other compromised systems - Also useful for network capacity monitoring NetFlow 3 Component system - Flow Exporter:A device that records network flows it sees and forwards data to a Flow Collector - Flow Collector:stores and pre-processes data sourced from one or more Flow Exporters - Analysis:Perform analysis (and visualisation) of flow data stored in a Flow Collector Packet Capture - Capture all network traffic and payload data for analysis - Gives a lot of insight but: - Takes up lots of space - Processing it can take a lot of resources - Potential privacy issues - Tools such as: - Wireshark etc… Where to monitor? - On the edge (border between the internet and local) will miss local problems - Monitoring locally will generate more data but can detect local problems How to sniff? - In packet-switched networks, packets are only sent to relevant hosts - Switches can have mirror ports, can mirror data from all ports or specific ports to certain port (Can get capacity issues) - Network Tap - ARP/NDP Tables - One client should have one MAC address connected to a switch port - Issues? - If you get a lot of MAC addresses for a single port (Or multiple VLAN’s on a port) - A single MAC address on multiple ports (MAC address spoofing) - An “important” MAC address appearing someplace else Automated Monitoring Tools - Manual monitoring is error-prone and takes forever - Lots of tools to aggregate data from many sources to automate monitoring, e.g: - LibreNMS - Zabbix - Prometheus - Etc… Intrusion Detection (IDS) - Automatically monitors a network for malicious activity or policy violations - Automatic notification of potential problems - Different types: - Network IDS monitors network traffic - I.e. sniffing - Host IDS runs locally on a computer How do they work? - Matching traffic and packets against rules - Signature database (e.g. known exploits etc…) - Reputation/blacklists (e.g. botnet C&C servers) - These get out of date - Protocol anomalies - Traffic anomalies - Challenge? - False positives and false negatives (doesn’t identify attack) - Tuning is important Intrusion Prevention - Takes IDS one step further and automatically responds to detected problems - Responses can include: - Block problem traffic - Block suspected user accounts - Segregate compromised hosts - Trigger an incident response process - Increase level of network monitoring IDS/IDP Tools - Many different tools … - Snort - Suricatta - Zeek Benefits of IDS/IPS - Automatically detected (and potentially prevent) attacks not stopped by other measures - Handle incompetence - Log information, allow auditing - Identify problems with security policies - Document existing threats - Deter violations - Produce reports (Good to show to managers) Limitations of an IDS/IPS - Configuration and maintenance - Is someone monitoring the system? - Performance issues - False positive/negative balance - Not great against newly published attacks - Less effective against evasion techniques (AET) - Don’t rely on them - Cannot compensate for holes in security - Many people rely on them for protection Darknets and Honeypots - Darknets → Using unused IP address space to monitor for unexpected network activity - Open up unused address space to the internet and see what is searching your network - Honeypots → Specific decoy systems set up to allow an attack and observe (and respond) - Divert attacker from critical systems - Collect information about the attack and their methods - Encourage the attack to stay long enough to document/respond - Trap and trace:Honeypot and an alarm - Legal issues? Enticement (legal) versus entrapment (illegal)! TL;DR - Hold up!! This TL;DR only contains information on what is usually examined! - (2022/23) - This may change each year, check with your lecturers LPWAN’s - (LoRa)WAN → LoRa modulation uses SS chirpmodulation(spread spectrum) - SS and chirp→ More immune to interference, long range, doppler resistant, multipath resistant (good in urban areas), scalable to many nodes - Spreading Factor → SF7→SF12 (lower SF = shorter range but faster, at same bandwidth - larger SF means longer to transmit same message) - LoRaGateways → star topology, ISM 868/915 MHz, security mechanisms - Duty Cycle → can only transmit for 1% per time period (e.g. every 24 hours) - DataRates → SF + bandwidth = DR:250 to 11,000 bits/s (59 payload to 230) - Device IDs → 64 bit DevEUI ID and AppEUI, also dynamic 32 bit DevAddr - Frame Counter → Protects against relay attacks - TTN → Usually sent MQTT messages over LoRaWAN to TTN - The uplink airtime is limited to 30 seconds per day (24 hours) per node. - The downlink messages are limited to 10 messages per day (24 hours) per node. - Sigfox → LoRaWAN competitor - Datapackage provided by operator (up to 140 messages a day, 12 byte payload) - Todevice can send 4 messages of 8 bytes each day - Weightless → Uses ISM 868MHz and TV white space (unused allocated spectrum) - M2M communication, 5km range, long battery life, cheap “$2 chip” - NB-IoT → Uses LTE frequencies and GSM towers - 7/8/900 MHz, slightly better coverage than “normal” GSM - Needs a low-cost sim card to use - Nano-satcoms → Satellites used as LPWAN channel - Monthly cost to use, but global coverage. E.g. 750 packets/device/month $5 - 192 bytes/packet - Battery Life → up to a year with 3000mAh battery (not the best) LR-WPAN’s - 802.15.4→ basis for most LR-WPAN’s, layer 1 and 2 of ISO 7-layer model - Not just 2.4GHz, can be used at different frequencies, down to 161MHz, up to 5.8GHz. Lower frequencies have longer range - Device Types → PAN coordinator (overall controller), Coordinator (provides synchronisation services… router), Full Function Device → can be either, and connect to many devices. Reduced Function Device → cannot be any, connects to only 1 other device - Network topologies → Either star or peer-to-peer, but routing is not defined in 802.15.4 - Addressing → Universal 64-bit address - IEEE EUI-64. Local 16-bit address - within the PAN, assigned by PAN coordinator - Frame structure → 802.15.4 also defines the frame structure. - Zigbee → sits above 802.15.4, is the network and application layer (layer 3+) - Mesh networking and multi-hop networking - 6LoWPAN → IPv6 over 802.15.4 networks, layer 3 (2.5?) of OSI 7-layer model - Compress → IPv6 compressed to fit into 802.15.4 - Address → IPv6 address from 802.15.4 address - Small header → As low as 2-bytes. Compared to normal IPv6 40-bytes - RPL → can use routing protocol for low-power and lossy networks (RPL is network layer), mesh network + multi-hop. ICMPv6 for control messages - Thread → 6LoWPAN, IP routing, UDP for mesh network - TCP for application - Other Standards → WirelessHART, MiWi - RPL - Rfc6550 (RPL - Routing Protocol for Low-Power and Lossy Networks) - Builds a Mesh network with 6LoWPAN with multi-hop routing - Creates tree-like topologies - Destination-oriented directed acyclic graphs (DODAGS) - An APL instance contains one or more DODAGs - Each node is assigned a distance-dependant rank - Further from DODAG root = higher rank - Range from the root node is used as the routing metric - Uses ICMPv6 for control messages WiFi WiFi - 802.11 - 802.11b - 2.5GHz DSSS - 802.11g - 2.4GHz OFDM (54Mb/s) - 802.11.n - 5/2.4GHz MIMO, OFDM (300-600Mb/s) - 802.11ac - 5GHz Mu-MIMO, OFDM (1733.3Mb/s) - 256 QAM - WiFi 5 - 802.11ax - 5GHz Mu-MIMO, OFDMA (2400Mb/s) - 1024 QAM - WiFi 6 - Orthogonal → peak of on subcarrier coincides with the null of adjacent subcarrier - Orthogonal Frequency Division Multiplexing (OFDM) allows more dense carriers, which saves bandwidth → overall faster speed for multiple devices on same channel (more efficient) - Orthogonal Frequency Division Multiple Access (OFDMA) → subdivides OFDM channels into even smaller channel sections, “subcarries” (good for lower bandwidth items to not take up whole channel - Beamforming → focus RF towards a client (good for medium range) - Mu-MIMO → good for faster speeds, give more i/o’s to a user. Multiple antennas for multiple streams - FDM vs OFDM (OFDM overlapps) - - - WiFi - OFDM and OFDMA - - Multiple Access → WiFi uses CSMA/CA (Carrier-Sense Multiple Access/Collision Avoidance) - wait until channel is clear then send - WiFi Bands → 2.4GHz is split into 14 20MHz channels (they overlap) 100mW EiRP - Same/close channels will interfere with each other (OFDM 20Mhz 4 channels non-overlapp, only 2 for 40MHz channels) - 5GHz → 3 UK bands - more channels, less overlapping - Dynamic Frequency Selection needed in band B 5GHz (otherwise interfere with radar/satellite weather) - 900MHz (802.11.ah) - Long range, low power WiFi. - … many different bands (6 and 60GHz) - BSS Colouring → contained within PHY header, device inherits its AP colour - Therefore, two devices on same channel can transmit at same time IF different colour! (better than before) - WEP → 128 bit WEP - WPA→ 128 bit key, temporal key integrity protocol, dynamically changes key, improved message integrity check Bluetooth Bluetooth → open spec, free to use - Low data rates, low duty cycles (< 1 Mb/s), low power - Operates in 2.4GHz, divides it into 79 channels of 1MHz (uses PSK) - Frequency Hopping → transmission hop between channels (1600 slots per second) - Each slot on a different channel, with a pseudo random sequence - Reduce RF interference, power spread evenly across frequency band - Can be adaptive (AFH), detect collision and move to less busy channels - Multiple Users → One master to 7 slaves - same hardware, slaves talk to master - Master determines hopping pattern & timing - Slaves can connect to another master (basic networking, not used much) - TDMA→ contention-free networking, slave/master can get more than 1 slot to communicate (devices which need more data rates can get it) - Frame Types → Async and synchronous frame types - SCO (Synchronous Connection Oriented) → real time data, fixed slot in each direction, not retransmitted (240 bits of data, depending on error correction) - Up to 64kbps with 80 bit payload (R3 repetition code) → good for voice communication - ACL (async connectionless link) → error correction with hamming code, retransmission - 433.9Kb/s both ways, or 732 and 57.6Kb/s Asymmetric - BT 5.0- High speed, location, and some low energy - BTle (low energy) 4.0 - profiles for devices (Generic Attribute Profile GATT), notifications, encryption - Beacons - phone scans and gets information Comparison of Wireless Technologies - WiFi + Easy to integrate with home networks + High bandwidth and security - Higher power - Bluetooth + Available on phones/tablets/laptops + Some existing devices like speakers etc… - Short range - ZigBee - Protocol over 802.15.4 layer at 2.4GHz or /868/915 MHz - 64 bit addressing - Payload up to 104 bytes - ZigBee can have different network topologies (Always need 1 ZigBee Coordinator) - Star → 1 Coordinator, Rest are ZigBee devices - Mesh → 1 Coordinator, Many ZigBee Routers tightly connected, with Devices connected to the Routers - Cluster Tree → 1 Coordinator, Many ZigBee Routers only connected to the coordinator;Devices connected to Routers - 6LowPAN over 802.15.4 radios (Used in Ikea Tradfri) + Low power radios (typical 10mW) + E xcellent integration with internet + Gains IPv6 Characteristics + Mesh networking (RPL - Routing Protocol for Low-Power and Lossy Networks) + Can use 2.4GHz or 868/900 MHz - Need a gateway/hub to LAN/WAN - Sigfox - Ultra Narrow Band (UNB) cellular-style - 868/915 Mhz - Less than 25mW - 100 bits per second, slow - Range ~3-30 km - Data package provided by an operator - Up to 140 messages per day - Payload is only 12 bytes - Can transmit 4 messages of 8 bytes to the device each day - NB-IoT → Narrowband-IoT - Part of cellular/LTE Cat NB1 - 700Mhz, 800Mhz, 900Mhz - 200 kbps approx - Promise wide coverage - LoraWAN™ - Wide area low power network using gateways - Based on stars - gateways link together - Up to 50kbps, uses ISM 868/915 Mhz bands - Lots of security mechanism - Proprietary PHY layer (Semtech) - SS chirp modulation very robust IPv6 Solutions? - to running out of IPv4 - NAT → Breaks end-to-end, can slow down (switching headers). NAT can be therefore bad for real-time applications - Address Recovery → buyback address space - CGNAT → Carrier-Grade NAT, can be slow, breaks end-to-end, limits / removes port-forwarding, stateful, everyone punished by IP abuse, security and privacy implications, problems with scalability, reachability, performance. Stateful!! Deployment - IPv6 address space, routing, firewall, IPv6 DNS, IPv6 allocation: - IPv6 address allocation → SLAAC (stateless address auto-config), DHCPv6 - Usually DHCPv6 w (prefix delegation) from router to ISP, SLAAC internally - DHCPv6 UID (DUIDs) → Identify host to DHCPv6 server Dual-Stack → both v4+v6 on the same system - Need firewall for both protocols (layer 2 security, Router Advertisement guard) - This is the best for speed and accessibility :) - But is it bad? - More issues, as there are now two networks! Double the IP config, more overhead for DHCP and firewall, more/new hardware, doesn’t help free IPv4 Tunnelling → IPv6 inside IPv4. This reduces MTU, can increase latency and cause issues with GeoIP services - 6in4→ “Protocol 41” in IPv4 header, essentially put an IPv4 header in front of IPv4 - Requires protocol 41 support in router - Hurricane Electric does this - 6in4requires you to have a public IPv4 address, clients behind CGNAT are not supported - may have struggles with NAT - Teredo→ IPv6 in IPv4 UDP packets - Doesn’t need coordination of local network, and provides 1 IPv6 address per tunnel endpoint - Requires servers→ sets up connection, detects NAT, helps establish connection between client and relay, client talks to server to keep alive - and relays→ forwards traffic between IPv6 hosts and Teredo client. All bandwidth goes through these relays - VPN → Can tunnel IPv6 and IPv4 using TCP or UDP - Encryption overhead - UDP or IPSEC IPv6support onIPv4only networks NAT64/DNS64→ helps IPv6 only devices talk to IPv4 servers (e.g. phones) - NAT64→ translate IPv6 to IPv4 and vice versa (essentially put IPv4 in IPv6) - IPv4 can be put into IPv6 address with prefix 64:ff9b::, final 32 bits are the IPv4 address. Chops of prefix to get IPv4 - Stateless → Maps each IPv6 to IPv4 (used in front of IPv4 only servers) - Stateful → Tracks IPv6 addresses, and dynamically maps to IPv4 + port - DNS64→ Makes fake AAAA record (IPv6) for domain with only A record (IPv4) - Breaks DNSSEC(security) - Does not help IPv4 literals (e.g. connect to server 192.0.2.10), or IPv4-only sockets, VPN clients connecting to IPv4 gateways don’t work through NAT64 - IPv4support onIPv6only networks - 464XLAT → helps connect IPv4 only applications (/devices) to work over a IPv6 network (ISP’s IPv6 only network). (Used mainly on mobile data networks) Contains two translators: - CLAT (stateless) → makes client think they have an IPv4 address;converts IPv4 packets into IPv6 packets. CLAT can be on the customer’s device (e.g. a phone) - PLAT (stateful, effectively NAT64) → IPv6 to IPv4, leaving the IPv6-only land - - DS-LITE → Dual-Stack Lite - Native IPv6, tunnelled and NATed IPv4 - Gives public IPv6, but private IPv4 1. Client device talks to CPE as if it was a dual-stack. 2. The CPE tunnels IPv4 packets inside IPv6 over the ISP’s network, 3. NAT router on the end (between ISP IPv6 and IPv4) to convert the tunnelled IPv4 to normal IPv4, then to the site - Bad for IPv4→ downfalls of CGNAT + reduced IPv4 MTU - CanrunDS-lite onclient device - - Differences - 464XLAT does not require IPv4 address provisioning, whereas DS-Lite does; where the ISP gives your local CPE a private IPv4 address (GCNATed) and then the CPE will tunnel this IPv4 through the ISP’s v6 network - DS-Lite is normally used by ISPs to provide IPv4 and IPv6 to their users, users need DS-lite compatible CPE - 464XLAT is normally used by the end-users on their devices (CLAT) to allow their device to access IPv4-only servers - DS-Lite uses NAT, 464XLAT uses NAT64 Network Security - Defence is a continual cycle - Assessment - Protection - Detection - Response Mandiant Cyber Attack Life Cycle 1. Initial Reconnaissance → Aim:Scope out system 2. Initial Compromise → Aim:Execute malicious code on target system’s 3. Establish Foothold → Aim:Gain a level of access/control over target 4. Escalate Privileges → Aim:Gain more control and access through more privileges 5. Internal Recon→ Aim:Gain more understanding of target’s network/system 6. Move Laterally → Aim:Gain more access to more systems 7. MaintainPresence → Aim:Establish persistent access ⇒ Back to4 8. Complete Mission→ Aim:Achieve overall goal Big weakness is the users! Need good security policy - Should be:organisation-specific, practical and enforceable, regularly updated, encourages issue finding, set whowill fix issues - Don’t forget:process to report issues, details on how to respond, - Bad:shouldn’t hinder users work, should have a clear goal, users need to feel part of the solution - Update devices often! → switches, wi-fi AP’s, update it all, even IoT devices - Audit regularly! → are those firewall rules/old server still needed? Is everything up to date? Does the network have unknown devices/config changes? Regular pen tests!! - Response cycle: - - First HopSecurity → deals with rogue responses (ARP, RA attacks)... don’t pass on untrusted responses - e.g. Cisco DHCP guard (only allow DHCP responses from known DHCP server) - IPv6→ Teredo can bypass firewalls and filtering, monitor IPv6 traffic too! Its new and evolving Monitoring - Why? → Security, policy compliance, capacity planning, troubleshooting and diagnostics, problem identification - What? → traffic metadata/payloads, ARP/NDP tables, routes, switch port utilisation, firewall logs, DNS entries & queries Network Flow Monitoring - What does this collect? → IP source & destination, protocol(s) and ports, packet count & data total - How does this help? → builds profile of normal traffic, can spot abnormal traffic - automate this (Cisco Netflow) Packet Capture - What? → capture all network traffic & payload data for analysis - But → lots of data, processing it can use lots of resources, privacy issues - How? → use mirror ports on switches (cap issues), network tap, - Use ARP/NDP tables → one MAC address per switch port, otherwise potential issues, or a moving MAC address IntrusionDetection(IDS) - How they work? → monitors network traffic, can match traffic against rules: - Signature based, reputation/blacklists, protocol anomalies, traffic anomalies - Challenges? → False positives/negatives, need to tune - issues with both IntrusionPrevention→ automatically responds to detected problems - How? → blocks traffic/suspected user accounts, segregate compromised hosts, trigger response process, increase monitoring if suspected - Benefits? → Automatic, logs info for auditing, identify problems with security policies, document threats, deter violations, produce reports!! - Limitations? → configuration and maintenance, performance issues, false positive/negatives, not good against new attacks, less effective against evasion techniques, DO NOT RELY on them - cannot compensate for holes in security - Darknets → Using unused IP address space to monitor for unexpected network activity - Honeypots → Specific decoy systems set up to allow an attack and observe (legal issues) Projects - Glacsweb Probes → 173 Mhz radio transceiver (Iceland) RADIO + LONG RANGE WIFI - Sensors:temperature, pressure, strain, conductivity, accelerometer - Own Gwpacket and protocols - Large scale WiFi - Speed saves time and energy – but uses 500mW - Off the shelf components - Very directional - but can get long range because of this - IPv6 over WiFi - IPv6 over Internet - - MountainSensing (Scotland) - 6LoWPAN + RADIO - 6LoWPAN using RPL (Contiki-NG) - - Oxford River Sensing (flood checking) - LORAWAN - Uses LoRaWAN - Shutdown in 2023 :( https://flood.network/ - Barcelonaagriculture 802.15.4 + RADIO - IkeaTradfri → 6LoWPAN","libVersion":"0.3.2","langs":""}